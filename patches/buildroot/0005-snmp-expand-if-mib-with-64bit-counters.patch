From 41dc465924c505a279fd7ae348a006263ea49c53 Mon Sep 17 00:00:00 2001
From: Adam Wujek <adam.wujek@cern.ch>
Date: Tue, 16 Feb 2016 16:15:27 +0100
Subject: [PATCH 2/2] snmp: expand if-mib with 64bit counters

Add if-mib/ifXTable to the SNMPd. It adds 64bit (HC) counters to the ifTable.
---
 package/netsnmp/netsnmp.mk |   11 ++++++++---
 1 file changed, 8 insertions(+), 3 deletions(-)

diff --git a/package/netsnmp/netsnmp.mk b/package/netsnmp/netsnmp.mk
index 5d789b9..bc8a531 100644
--- a/package/netsnmp/netsnmp.mk
+++ b/package/netsnmp/netsnmp.mk
@@ -18,9 +18,11 @@ NETSNMP_CONF_OPT = --with-persistent-directory=/var/lib/snmp --disable-static \
 		--enable-silent-libtool --enable-mfd-rewrites \
 		--with-sys-contact="root@localhost" \
 		--with-sys-location="Unknown" \
-		--with-mib-modules="host ucd-snmp/dlmod" \
+		--with-mib-modules="host ucd-snmp/dlmod if-mib/ifXTable agentx" \
 		--with-out-mib-modules="disman/event disman/schedule utilities" \
-		--with-out-transports="Unix"
+		--with-out-transports="Unix" \
+		--includedir=$(TARGET_DIR) \
+	        --prefix=$(TARGET_DIR) 
 NETSNMP_BLOAT_MIBS = BRIDGE DISMAN-EVENT DISMAN-SCHEDULE DISMAN-SCRIPT EtherLike RFC-1215 RFC1155-SMI RFC1213 SCTP SMUX
 
 ifeq ($(BR2_ENDIAN),"BIG")
@@ -60,6 +62,9 @@ define NETSNMP_INSTALL_TARGET_CMDS
 		DESTDIR=$(TARGET_DIR) install
 	$(INSTALL) -D -m 0755 package/netsnmp/S59snmpd \
 		$(TARGET_DIR)/etc/init.d/S59snmpd
+	cp -rf $(TARGET_DIR)$(TARGET_DIR)/net-snmp $(TARGET_DIR)/include
+	cp -rf $(TARGET_DIR)$(TARGET_DIR)/share $(TARGET_DIR)/share
+	rm -rf $(TARGET_DIR)/home
 	for mib in $(NETSNMP_BLOAT_MIBS); do \
 		rm -f $(TARGET_DIR)/usr/share/snmp/mibs/$$mib-MIB.txt; \
 	done
@@ -78,7 +83,7 @@ define NETSNMP_STAGING_NETSNMP_CONFIG_FIXUP
 		-e "s,^exec_prefix=.*,exec_prefix=\'$(STAGING_DIR)/usr\',g" \
 		-e "s,^includedir=.*,includedir=\'$(STAGING_DIR)/usr/include\',g" \
 		-e "s,^libdir=.*,libdir=\'$(STAGING_DIR)/usr/lib\',g" \
-		$(STAGING_DIR)/usr/bin/net-snmp-config
+		$(STAGING_DIR)/usr/bin/net-snmp-config	
 endef
 
 NETSNMP_POST_INSTALL_STAGING_HOOKS += NETSNMP_STAGING_NETSNMP_CONFIG_FIXUP
-- 
1.7.10.4

