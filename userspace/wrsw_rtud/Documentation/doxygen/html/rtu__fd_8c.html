<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>wrsw_rtud: software/wrsw_rtud/rtu_fd.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.2 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<h1>software/wrsw_rtud/rtu_fd.c File Reference</h1>  </div>
</div>
<div class="contents">
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;unistd.h&gt;</code><br/>
<code>#include &lt;pthread.h&gt;</code><br/>
<code>#include &lt;hw/wrsw_rtu_wb.h&gt;</code><br/>
<code>#include &lt;hw/trace.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="rtu__fd_8h_source.html">rtu_fd.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="rtu__drv_8h_source.html">rtu_drv.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="rtu__hash_8h_source.html">rtu_hash.h</a>&quot;</code><br/>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfd__handle.html">fd_handle</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Filtering Database entry handle.  <a href="structfd__handle.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structhw__req.html">hw_req</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">HW (HTAB or HCAM) write request.  <a href="structhw__req.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#a7dbeef729dfc4c71067fcc69e61a311c">HTAB</a>&#160;&#160;&#160;0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#a99fc6bd758a4f51ba5bf1899c628517f">HCAM</a>&#160;&#160;&#160;1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#a1efb00acf4b9580aed8083beefec43ad">HW_WRITE_REQ</a>&#160;&#160;&#160;0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#ad22cd7b5df8ed4b75325815a93133cff">HW_CLEAN_REQ</a>&#160;&#160;&#160;1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#a841b291dedf074d07299e089dc0722e6">FOUND</a>&#160;&#160;&#160;1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#a33bfc1f995233887a0414369c36936b8">NOT_FOUND</a>&#160;&#160;&#160;0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#a3944e7b079143dd3ec8d281ea8d1a4ce">NOT_FOUND_AND_FULL</a>&#160;&#160;&#160;-1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#aa1e20bb576cfa14dc631d153c8890d53">NOT_FOUND_AND_FIRST</a>&#160;&#160;&#160;-1</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structhw__req.html">hw_req</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#a08b49d103d388a5a58d34e3b0cda316d">tail</a> (struct <a class="el" href="structhw__req.html">hw_req</a> *head)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#a5c35ac79f2f120218bd347f8ba4a7526">clean_list</a> (struct <a class="el" href="structhw__req.html">hw_req</a> *head)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#a35f2f8ec463ff7a18d102124a089bb4f">add_hw_req</a> (int type, int mem, uint16_t addr, struct <a class="el" href="structfiltering__entry.html">filtering_entry</a> *ent)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds a new HW request at the end of the main hw request list.  <a href="#a35f2f8ec463ff7a18d102124a089bb4f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#a6ec650abf3a907daccbec714792e0739">write_htab_entry</a> (uint16_t addr, struct <a class="el" href="structfiltering__entry.html">filtering_entry</a> *e)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#ac3a5a86fd5d55d3c5eb13cabc9081b27">write_hcam_entry</a> (uint16_t addr, struct <a class="el" href="structfiltering__entry.html">filtering_entry</a> *e)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#a6adac7cc11396b3e0fd1017107a02e0c">clean_htab_entry</a> (uint16_t addr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#ab2568eee07833ac0a23d3ea1bbf6fa97">clean_hcam_entry</a> (uint16_t addr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#ae306e38bcfdeb25a970e7165a8e52d9c">zbt_addr</a> (uint16_t hash, int bucket)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#a268a0c1529712309ab8fcc950f0bcc40">cam_addr</a> (int bucket)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#a0491d70b90b4fc93ef54314224a58227">cam_bucket</a> (uint16_t cam_addr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#ad90f54782bdbdda25d217bc41284c86b">matched</a> (uint32_t word, int offset)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#a8edbf49b91bd42ea3b6280c6dae92934">htab_contains</a> (uint8_t mac[ETH_ALEN], uint8_t fid, int *bucket, struct <a class="el" href="structfiltering__entry.html">filtering_entry</a> **ent)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks whether a given pair (mac,fid) is at HTAB.  <a href="#a8edbf49b91bd42ea3b6280c6dae92934"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#a1f2f6596d8869bfbe3a6425fd3e50e08">hcam_contains</a> (uint8_t mac[ETH_ALEN], uint8_t fid, int *bucket, struct <a class="el" href="structfiltering__entry.html">filtering_entry</a> **ent)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#ad8199de5b96236dce9d57677c6061e67">find_empty_bucket_in_hcam</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Find the most appropriate empty bucket to insert new hash collision list. The algorithm first finds the fragment which contains the max number of consecutive empty positions. Then divides this fragment into two parts: first block is still available for possible increment of any existing list; The second block will be available for the new list. The algorithm keeps a fair and uniform distribution of fragments space.  <a href="#ad8199de5b96236dce9d57677c6061e67"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#aaeabcb9d36637fe2ae5ecd0006ac3cae">set_active_bank</a> (int b)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the filtering database active bank both in software and hardware. Note both HTAB and HCAM active banks are switched at once. Bank switching is delayed until MFIFO is empty (method remains blocked meanwhile).  <a href="#aaeabcb9d36637fe2ae5ecd0006ac3cae"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#a9ccd84efb27ba85e438e7fa19e389af1">clean_fd</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#a4037dd16f91309a010b8888d1a57efe8">clean_vd</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#a671c6b8968e24624191059002ea4e2c4">clean_aging_map</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Clean HCAM aging register and HTAB aging bitmap.  <a href="#a671c6b8968e24624191059002ea4e2c4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#a1b5d319e3d5712a9c89876b25c49d8b3">update_aging_map</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Update aging map cache with contents read from aging registers at HW.  <a href="#a1b5d319e3d5712a9c89876b25c49d8b3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#ae002607bee9b3436360c640daee499d2">rtu_hw_commit</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Read changes from hw_req_list and invoke RTU driver to efectively write or clean the entry.  <a href="#ae002607bee9b3436360c640daee499d2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#a9918a401b7385982ab5f934fb5e3659f">rtu_fd_commit</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Commits entry changes at software to hardware HTAB and HCAM.  <a href="#a9918a401b7385982ab5f934fb5e3659f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#afd787cdd8dbdf9687685cbed441eab70">shift_htab_entries</a> (uint16_t hash, int bucket)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Shifts HTAB list one position, starting at bucket.  <a href="#afd787cdd8dbdf9687685cbed441eab70"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#a47cef05cfcf94a45f5d047bc51e29bae">shift_hcam_entries</a> (int bucket)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Shifts HCAM list one position, starting at bucket. If entry to remove is end of bucket, marks previous one (if exists) as the new end of bucket.  <a href="#a47cef05cfcf94a45f5d047bc51e29bae"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#a58d8e42f18a872c844dfe41bf1e858aa">delete_htab_entry</a> (uint16_t hash, int bucket)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Deletes HTAB entry by shifting HTAB list. If HCAM is used, it also copies first HCAM entry to last HTAB bucket.  <a href="#a58d8e42f18a872c844dfe41bf1e858aa"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#a4eefb460927b62e2dba66084474cc6f8">delete_hcam_entry</a> (int bucket)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Deletes HCAM entry by shifting HCAM list. Updates HTAB last entry if neccessary.  <a href="#a4eefb460927b62e2dba66084474cc6f8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#a8b6c2358af2e8d7009b715e2487a6f7f">rtu_fd_age_out</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#a38d0811417bc6e78af5ea33514ec73f4">rtu_fd_age_update</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Updates the age of filtering entries accessed in the last period.  <a href="#a38d0811417bc6e78af5ea33514ec73f4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#a3f14008b697ee240b5df33c81d063950">rtu_fd_init</a> (uint16_t poly, unsigned long aging)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the RTU filtering database.  <a href="#a3f14008b697ee240b5df33c81d063950"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#a63a062309cc10c7ae0ba9f9a1dae0b00">rtu_fd_create_entry</a> (uint8_t mac[ETH_ALEN], uint16_t vid, uint32_t port_map, int dynamic)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates or updates a filtering entry in the filtering database.  <a href="#a63a062309cc10c7ae0ba9f9a1dae0b00"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#aaff992c9bb044fc888963fe201468181">rtu_fd_set_hash_poly</a> (uint16_t poly)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the polynomial used for hash calculation. Changing the hash polynomial requires removing any existing entry from RTU table. Note in case RTU table becomes full, this function may be used to change hash polynomial (thus leading to a different hash distribution).  <a href="#aaff992c9bb044fc888963fe201468181"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#abd7b51f1af31d9e6508209198843d2e8">rtu_fd_set_aging_time</a> (unsigned long t)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the aging time for dynamic filtering entries.  <a href="#abd7b51f1af31d9e6508209198843d2e8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#a3e4731c162738b2e5141bc85a496b831">rtu_fd_flush</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Deletes old filtering entries from filtering database to support changes in active topology.  <a href="#a3e4731c162738b2e5141bc85a496b831"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structfiltering__entry.html">filtering_entry</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#acbf5fc9d04e59e85d2fbd4c242ab3ee3">rtu_fd_lookup_htab_entry</a> (int index)</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structhw__req.html">hw_req</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#a873c1e7c522e439133d94e4b84c27e35">hw_req_list</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">HW write and clean requests list. Used to temporarily store entry changes performed at SW.  <a href="#a873c1e7c522e439133d94e4b84c27e35"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structfiltering__entry.html">filtering_entry</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#a9e712440333d857c99be492d1a0e0372">rtu_htab</a> [HTAB_ENTRIES][RTU_BUCKETS]</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Mirror of ZBT SRAM memory MAC address table. Main filtering table organized as hash table with 4-entry buckets. Note both banks have the same content. Therefore SW only mirrors one bank.  <a href="#a9e712440333d857c99be492d1a0e0372"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structfiltering__entry.html">filtering_entry</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#ab0b79e554dca73313d259aaa956364ab">rtu_hcam</a> [CAM_ENTRIES]</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Mirror of CAM lookup table. For RTU entries with more than 4 matches.  <a href="#ab0b79e554dca73313d259aaa956364ab"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#aaccbfb752723bf7af1abb8b0fe9858bc">bank</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Table bank to write entries to. HTAB and HCAM banks will be handled according to this single bank value.  <a href="#aaccbfb752723bf7af1abb8b0fe9858bc"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#ab5d85a07008a2c57cbeed2a9aaf97bc6">rtu_agr_htab</a> [RTU_ARAM_MAIN_WORDS]</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Mirror of Aging RAM.  <a href="#ab5d85a07008a2c57cbeed2a9aaf97bc6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#a93010a038b0aa9d21acefafd183d56b0">rtu_agr_hcam</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#adc3262f00fca44e43c73e6bb615bf2ce">aging_time</a> = DEFAULT_AGING_TIME</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Max time that a dynamic MAC entry can remain in the MAC table after being used. [seconds].  <a href="#adc3262f00fca44e43c73e6bb615bf2ce"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structvlan__table__entry.html">vlan_table_entry</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#acbfec691155f65d61cb3501647b82ded">vlan_tab</a> [NUM_VLANS]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static pthread_mutex_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtu__fd_8c.html#a481e025310f2c6cb58da1ec942bfd8f2">fd_mutex</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Mutex used to synchronise concurrent access to the filtering database.  <a href="#a481e025310f2c6cb58da1ec942bfd8f2"></a><br/></td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a841b291dedf074d07299e089dc0722e6"></a><!-- doxytag: member="rtu_fd.c::FOUND" ref="a841b291dedf074d07299e089dc0722e6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FOUND&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a99fc6bd758a4f51ba5bf1899c628517f"></a><!-- doxytag: member="rtu_fd.c::HCAM" ref="a99fc6bd758a4f51ba5bf1899c628517f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HCAM&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a7dbeef729dfc4c71067fcc69e61a311c"></a><!-- doxytag: member="rtu_fd.c::HTAB" ref="a7dbeef729dfc4c71067fcc69e61a311c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HTAB&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ad22cd7b5df8ed4b75325815a93133cff"></a><!-- doxytag: member="rtu_fd.c::HW_CLEAN_REQ" ref="ad22cd7b5df8ed4b75325815a93133cff" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HW_CLEAN_REQ&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a1efb00acf4b9580aed8083beefec43ad"></a><!-- doxytag: member="rtu_fd.c::HW_WRITE_REQ" ref="a1efb00acf4b9580aed8083beefec43ad" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HW_WRITE_REQ&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a33bfc1f995233887a0414369c36936b8"></a><!-- doxytag: member="rtu_fd.c::NOT_FOUND" ref="a33bfc1f995233887a0414369c36936b8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NOT_FOUND&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="aa1e20bb576cfa14dc631d153c8890d53"></a><!-- doxytag: member="rtu_fd.c::NOT_FOUND_AND_FIRST" ref="aa1e20bb576cfa14dc631d153c8890d53" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NOT_FOUND_AND_FIRST&#160;&#160;&#160;-1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a3944e7b079143dd3ec8d281ea8d1a4ce"></a><!-- doxytag: member="rtu_fd.c::NOT_FOUND_AND_FULL" ref="a3944e7b079143dd3ec8d281ea8d1a4ce" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NOT_FOUND_AND_FULL&#160;&#160;&#160;-1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a35f2f8ec463ff7a18d102124a089bb4f"></a><!-- doxytag: member="rtu_fd.c::add_hw_req" ref="a35f2f8ec463ff7a18d102124a089bb4f" args="(int type, int mem, uint16_t addr, struct filtering_entry *ent)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int add_hw_req </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"> <em>mem</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structfiltering__entry.html">filtering_entry</a> *&#160;</td>
          <td class="paramname"> <em>ent</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Adds a new HW request at the end of the main hw request list. </p>

</div>
</div>
<a class="anchor" id="a268a0c1529712309ab8fcc950f0bcc40"></a><!-- doxytag: member="rtu_fd.c::cam_addr" ref="a268a0c1529712309ab8fcc950f0bcc40" args="(int bucket)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static uint16_t cam_addr </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"> <em>bucket</em>&#160;)</td>
          <td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a0491d70b90b4fc93ef54314224a58227"></a><!-- doxytag: member="rtu_fd.c::cam_bucket" ref="a0491d70b90b4fc93ef54314224a58227" args="(uint16_t cam_addr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int cam_bucket </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"> <em>cam_addr</em>&#160;)</td>
          <td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a671c6b8968e24624191059002ea4e2c4"></a><!-- doxytag: member="rtu_fd.c::clean_aging_map" ref="a671c6b8968e24624191059002ea4e2c4" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void clean_aging_map </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">&#160;)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Clean HCAM aging register and HTAB aging bitmap. </p>

</div>
</div>
<a class="anchor" id="a9ccd84efb27ba85e438e7fa19e389af1"></a><!-- doxytag: member="rtu_fd.c::clean_fd" ref="a9ccd84efb27ba85e438e7fa19e389af1" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void clean_fd </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">&#160;)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Filtering database initialisation. </p>

</div>
</div>
<a class="anchor" id="ab2568eee07833ac0a23d3ea1bbf6fa97"></a><!-- doxytag: member="rtu_fd.c::clean_hcam_entry" ref="ab2568eee07833ac0a23d3ea1bbf6fa97" args="(uint16_t addr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int clean_hcam_entry </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"> <em>addr</em>&#160;)</td>
          <td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a6adac7cc11396b3e0fd1017107a02e0c"></a><!-- doxytag: member="rtu_fd.c::clean_htab_entry" ref="a6adac7cc11396b3e0fd1017107a02e0c" args="(uint16_t addr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int clean_htab_entry </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"> <em>addr</em>&#160;)</td>
          <td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a5c35ac79f2f120218bd347f8ba4a7526"></a><!-- doxytag: member="rtu_fd.c::clean_list" ref="a5c35ac79f2f120218bd347f8ba4a7526" args="(struct hw_req *head)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void clean_list </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structhw__req.html">hw_req</a> *&#160;</td>
          <td class="paramname"> <em>head</em>&#160;)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Removes all elements from the hw_req_list </p>

</div>
</div>
<a class="anchor" id="a4037dd16f91309a010b8888d1a57efe8"></a><!-- doxytag: member="rtu_fd.c::clean_vd" ref="a4037dd16f91309a010b8888d1a57efe8" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void clean_vd </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">&#160;)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>VLAN database initialisation. VLANs are initially marked as disabled. </p>

</div>
</div>
<a class="anchor" id="a4eefb460927b62e2dba66084474cc6f8"></a><!-- doxytag: member="rtu_fd.c::delete_hcam_entry" ref="a4eefb460927b62e2dba66084474cc6f8" args="(int bucket)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void delete_hcam_entry </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"> <em>bucket</em>&#160;)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Deletes HCAM entry by shifting HCAM list. Updates HTAB last entry if neccessary. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">bucket</td><td>CAM entry address </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a58d8e42f18a872c844dfe41bf1e858aa"></a><!-- doxytag: member="rtu_fd.c::delete_htab_entry" ref="a58d8e42f18a872c844dfe41bf1e858aa" args="(uint16_t hash, int bucket)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void delete_htab_entry </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"> <em>hash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"> <em>bucket</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Deletes HTAB entry by shifting HTAB list. If HCAM is used, it also copies first HCAM entry to last HTAB bucket. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">hash</td><td>hashcode for entry to remove. </td></tr>
    <tr><td class="paramname">bucket</td><td>HTAB bucket for entry to remove </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ad8199de5b96236dce9d57677c6061e67"></a><!-- doxytag: member="rtu_fd.c::find_empty_bucket_in_hcam" ref="ad8199de5b96236dce9d57677c6061e67" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int find_empty_bucket_in_hcam </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">&#160;)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find the most appropriate empty bucket to insert new hash collision list. The algorithm first finds the fragment which contains the max number of consecutive empty positions. Then divides this fragment into two parts: first block is still available for possible increment of any existing list; The second block will be available for the new list. The algorithm keeps a fair and uniform distribution of fragments space. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>bucket index or -1 if the HCAM table is full. </dd></dl>

</div>
</div>
<a class="anchor" id="a1f2f6596d8869bfbe3a6425fd3e50e08"></a><!-- doxytag: member="rtu_fd.c::hcam_contains" ref="a1f2f6596d8869bfbe3a6425fd3e50e08" args="(uint8_t mac[ETH_ALEN], uint8_t fid, int *bucket, struct filtering_entry **ent)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int hcam_contains </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"> <em>mac</em>[ETH_ALEN], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"> <em>fid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"> <em>bucket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structfiltering__entry.html">filtering_entry</a> **&#160;</td>
          <td class="paramname"> <em>ent</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Checks whether a given pair (mac,fid) is at HCAM </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">mac</td><td>mac address </td></tr>
    <tr><td class="paramname">fid</td><td>filtering database identifier </td></tr>
    <tr><td class="paramname">bucket</td><td>inout param.Returns the bucket number where the entry was found </td></tr>
    <tr><td class="paramname">ent</td><td>pointer to entry found. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 if entry was not found. 1 if entry was found. -1 if entry was not found and the end of bucket was reached. -ENOMEM if no more entries after the end of bucket. -EINVAL if bucket &gt;= CAM_ENTRIES or HCAM inconsistent. </dd></dl>

</div>
</div>
<a class="anchor" id="a8edbf49b91bd42ea3b6280c6dae92934"></a><!-- doxytag: member="rtu_fd.c::htab_contains" ref="a8edbf49b91bd42ea3b6280c6dae92934" args="(uint8_t mac[ETH_ALEN], uint8_t fid, int *bucket, struct filtering_entry **ent)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int htab_contains </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"> <em>mac</em>[ETH_ALEN], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"> <em>fid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"> <em>bucket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structfiltering__entry.html">filtering_entry</a> **&#160;</td>
          <td class="paramname"> <em>ent</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Checks whether a given pair (mac,fid) is at HTAB. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">mac</td><td>mac address </td></tr>
    <tr><td class="paramname">fid</td><td>filtering database identifier </td></tr>
    <tr><td class="paramname">bucket</td><td>inout param.Returns the bucket number where the entry was found </td></tr>
    <tr><td class="paramname">ent</td><td>pointer to entry found. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 if entry was not found. 1 if entry was found. -1 if not found and HTAB was full for the corresponding hash. -EINVAL if bucket &gt;= RTU_BUCKETS </dd></dl>

</div>
</div>
<a class="anchor" id="ad90f54782bdbdda25d217bc41284c86b"></a><!-- doxytag: member="rtu_fd.c::matched" ref="ad90f54782bdbdda25d217bc41284c86b" args="(uint32_t word, int offset)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int matched </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"> <em>word</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"> <em>offset</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a8b6c2358af2e8d7009b715e2487a6f7f"></a><!-- doxytag: member="rtu_fd.c::rtu_fd_age_out" ref="a8b6c2358af2e8d7009b715e2487a6f7f" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void rtu_fd_age_out </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">&#160;)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>For each filtering entry in the filtering database, this method checks its last access time and removes it in case entry is older than the aging time. </p>

</div>
</div>
<a class="anchor" id="a38d0811417bc6e78af5ea33514ec73f4"></a><!-- doxytag: member="rtu_fd.c::rtu_fd_age_update" ref="a38d0811417bc6e78af5ea33514ec73f4" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void rtu_fd_age_update </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">&#160;)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Updates the age of filtering entries accessed in the last period. </p>

</div>
</div>
<a class="anchor" id="a9918a401b7385982ab5f934fb5e3659f"></a><!-- doxytag: member="rtu_fd.c::rtu_fd_commit" ref="a9918a401b7385982ab5f934fb5e3659f" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void rtu_fd_commit </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">&#160;)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Commits entry changes at software to hardware HTAB and HCAM. </p>

</div>
</div>
<a class="anchor" id="a63a062309cc10c7ae0ba9f9a1dae0b00"></a><!-- doxytag: member="rtu_fd.c::rtu_fd_create_entry" ref="a63a062309cc10c7ae0ba9f9a1dae0b00" args="(uint8_t mac[ETH_ALEN], uint16_t vid, uint32_t port_map, int dynamic)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rtu_fd_create_entry </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"> <em>mac</em>[ETH_ALEN], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"> <em>vid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"> <em>port_map</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"> <em>dynamic</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Creates or updates a filtering entry in the filtering database. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">mac</td><td>MAC address specification </td></tr>
    <tr><td class="paramname">vid</td><td>VLAN identifier </td></tr>
    <tr><td class="paramname">port_map</td><td>a port map specification with a control element for each outbound port to specify filtering for that MAC address specification and VID </td></tr>
    <tr><td class="paramname">dynamic</td><td>it indicates whether it's a dynamic entry </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 if entry was created or updated. -ENOMEM if no space is available. </dd></dl>

</div>
</div>
<a class="anchor" id="a3e4731c162738b2e5141bc85a496b831"></a><!-- doxytag: member="rtu_fd.c::rtu_fd_flush" ref="a3e4731c162738b2e5141bc85a496b831" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rtu_fd_flush </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">&#160;)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Deletes old filtering entries from filtering database to support changes in active topology. </p>

</div>
</div>
<a class="anchor" id="a3f14008b697ee240b5df33c81d063950"></a><!-- doxytag: member="rtu_fd.c::rtu_fd_init" ref="a3f14008b697ee240b5df33c81d063950" args="(uint16_t poly, unsigned long aging)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rtu_fd_init </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"> <em>poly</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"> <em>aging</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initializes the RTU filtering database. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">poly</td><td>hash polinomial. </td></tr>
    <tr><td class="paramname">aging</td><td>aging time </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="acbf5fc9d04e59e85d2fbd4c242ab3ee3"></a><!-- doxytag: member="rtu_fd.c::rtu_fd_lookup_htab_entry" ref="acbf5fc9d04e59e85d2fbd4c242ab3ee3" args="(int index)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structfiltering__entry.html">filtering_entry</a>* rtu_fd_lookup_htab_entry </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"> <em>index</em>&#160;)</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="abd7b51f1af31d9e6508209198843d2e8"></a><!-- doxytag: member="rtu_fd.c::rtu_fd_set_aging_time" ref="abd7b51f1af31d9e6508209198843d2e8" args="(unsigned long t)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rtu_fd_set_aging_time </td>
          <td>(</td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"> <em>t</em>&#160;)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Sets the aging time for dynamic filtering entries. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">t</td><td>new aging time value [seconds]. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>-EINVAL if t &lt; 10 or t &gt; 1000000 (802.1Q, Table 8.3); 0 otherwise. </dd></dl>

</div>
</div>
<a class="anchor" id="aaff992c9bb044fc888963fe201468181"></a><!-- doxytag: member="rtu_fd.c::rtu_fd_set_hash_poly" ref="aaff992c9bb044fc888963fe201468181" args="(uint16_t poly)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rtu_fd_set_hash_poly </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"> <em>poly</em>&#160;)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set the polynomial used for hash calculation. Changing the hash polynomial requires removing any existing entry from RTU table. Note in case RTU table becomes full, this function may be used to change hash polynomial (thus leading to a different hash distribution). </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">poly</td><td>binary polynomial representation. CRC-16-CCITT -&gt; 1+x^5+x^12+x^16 -&gt; 0x1021 CRC-16-IBM -&gt; 1+x^2+x^15+x^16 -&gt; 0x8005 CRC-16-DECT -&gt; 1+x^3+x^7+x^8+x^10+x^16 -&gt; 0x0589 </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ae002607bee9b3436360c640daee499d2"></a><!-- doxytag: member="rtu_fd.c::rtu_hw_commit" ref="ae002607bee9b3436360c640daee499d2" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void rtu_hw_commit </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">&#160;)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Read changes from hw_req_list and invoke RTU driver to efectively write or clean the entry. </p>

</div>
</div>
<a class="anchor" id="aaeabcb9d36637fe2ae5ecd0006ac3cae"></a><!-- doxytag: member="rtu_fd.c::set_active_bank" ref="aaeabcb9d36637fe2ae5ecd0006ac3cae" args="(int b)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void set_active_bank </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"> <em>n</em>&#160;)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set the filtering database active bank both in software and hardware. Note both HTAB and HCAM active banks are switched at once. Bank switching is delayed until MFIFO is empty (method remains blocked meanwhile). </p>

</div>
</div>
<a class="anchor" id="a47cef05cfcf94a45f5d047bc51e29bae"></a><!-- doxytag: member="rtu_fd.c::shift_hcam_entries" ref="a47cef05cfcf94a45f5d047bc51e29bae" args="(int bucket)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int shift_hcam_entries </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"> <em>bucket</em>&#160;)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Shifts HCAM list one position, starting at bucket. If entry to remove is end of bucket, marks previous one (if exists) as the new end of bucket. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>-1 if more entries remain in HCAM. Otherwise, returns the hash for entry, in order to help modifying the last HTAB entry </dd></dl>

</div>
</div>
<a class="anchor" id="afd787cdd8dbdf9687685cbed441eab70"></a><!-- doxytag: member="rtu_fd.c::shift_htab_entries" ref="afd787cdd8dbdf9687685cbed441eab70" args="(uint16_t hash, int bucket)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void shift_htab_entries </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"> <em>hash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"> <em>bucket</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Shifts HTAB list one position, starting at bucket. </p>

</div>
</div>
<a class="anchor" id="a08b49d103d388a5a58d34e3b0cda316d"></a><!-- doxytag: member="rtu_fd.c::tail" ref="a08b49d103d388a5a58d34e3b0cda316d" args="(struct hw_req *head)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structhw__req.html">hw_req</a> * tail </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structhw__req.html">hw_req</a> *&#160;</td>
          <td class="paramname"> <em>head</em>&#160;)</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Returns pointer to last element in hw_req_list. </p>

</div>
</div>
<a class="anchor" id="a1b5d319e3d5712a9c89876b25c49d8b3"></a><!-- doxytag: member="rtu_fd.c::update_aging_map" ref="a1b5d319e3d5712a9c89876b25c49d8b3" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void update_aging_map </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">&#160;)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Update aging map cache with contents read from aging registers at HW. </p>

</div>
</div>
<a class="anchor" id="ac3a5a86fd5d55d3c5eb13cabc9081b27"></a><!-- doxytag: member="rtu_fd.c::write_hcam_entry" ref="ac3a5a86fd5d55d3c5eb13cabc9081b27" args="(uint16_t addr, struct filtering_entry *e)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int write_hcam_entry </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structfiltering__entry.html">filtering_entry</a> *&#160;</td>
          <td class="paramname"> <em>e</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a6ec650abf3a907daccbec714792e0739"></a><!-- doxytag: member="rtu_fd.c::write_htab_entry" ref="a6ec650abf3a907daccbec714792e0739" args="(uint16_t addr, struct filtering_entry *e)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int write_htab_entry </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structfiltering__entry.html">filtering_entry</a> *&#160;</td>
          <td class="paramname"> <em>e</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ae306e38bcfdeb25a970e7165a8e52d9c"></a><!-- doxytag: member="rtu_fd.c::zbt_addr" ref="ae306e38bcfdeb25a970e7165a8e52d9c" args="(uint16_t hash, int bucket)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static uint16_t zbt_addr </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"> <em>hash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"> <em>bucket</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="adc3262f00fca44e43c73e6bb615bf2ce"></a><!-- doxytag: member="rtu_fd.c::aging_time" ref="adc3262f00fca44e43c73e6bb615bf2ce" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long <a class="el" href="rtu__fd_8c.html#adc3262f00fca44e43c73e6bb615bf2ce">aging_time</a> = DEFAULT_AGING_TIME<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Max time that a dynamic MAC entry can remain in the MAC table after being used. [seconds]. </p>

</div>
</div>
<a class="anchor" id="aaccbfb752723bf7af1abb8b0fe9858bc"></a><!-- doxytag: member="rtu_fd.c::bank" ref="aaccbfb752723bf7af1abb8b0fe9858bc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t <a class="el" href="rtu__fd_8c.html#aaccbfb752723bf7af1abb8b0fe9858bc">bank</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Table bank to write entries to. HTAB and HCAM banks will be handled according to this single bank value. </p>

</div>
</div>
<a class="anchor" id="a481e025310f2c6cb58da1ec942bfd8f2"></a><!-- doxytag: member="rtu_fd.c::fd_mutex" ref="a481e025310f2c6cb58da1ec942bfd8f2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutex_t <a class="el" href="rtu__fd_8c.html#a481e025310f2c6cb58da1ec942bfd8f2">fd_mutex</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Mutex used to synchronise concurrent access to the filtering database. </p>

</div>
</div>
<a class="anchor" id="a873c1e7c522e439133d94e4b84c27e35"></a><!-- doxytag: member="rtu_fd.c::hw_req_list" ref="a873c1e7c522e439133d94e4b84c27e35" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structhw__req.html">hw_req</a>* <a class="el" href="rtu__fd_8c.html#a873c1e7c522e439133d94e4b84c27e35">hw_req_list</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>HW write and clean requests list. Used to temporarily store entry changes performed at SW. </p>

</div>
</div>
<a class="anchor" id="a93010a038b0aa9d21acefafd183d56b0"></a><!-- doxytag: member="rtu_fd.c::rtu_agr_hcam" ref="a93010a038b0aa9d21acefafd183d56b0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t <a class="el" href="rtu__fd_8c.html#a93010a038b0aa9d21acefafd183d56b0">rtu_agr_hcam</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ab5d85a07008a2c57cbeed2a9aaf97bc6"></a><!-- doxytag: member="rtu_fd.c::rtu_agr_htab" ref="ab5d85a07008a2c57cbeed2a9aaf97bc6" args="[RTU_ARAM_MAIN_WORDS]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t <a class="el" href="rtu__fd_8c.html#ab5d85a07008a2c57cbeed2a9aaf97bc6">rtu_agr_htab</a>[RTU_ARAM_MAIN_WORDS]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Mirror of Aging RAM. </p>

</div>
</div>
<a class="anchor" id="ab0b79e554dca73313d259aaa956364ab"></a><!-- doxytag: member="rtu_fd.c::rtu_hcam" ref="ab0b79e554dca73313d259aaa956364ab" args="[CAM_ENTRIES]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structfiltering__entry.html">filtering_entry</a> <a class="el" href="rtu__fd_8c.html#ab0b79e554dca73313d259aaa956364ab">rtu_hcam</a>[CAM_ENTRIES]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Mirror of CAM lookup table. For RTU entries with more than 4 matches. </p>

</div>
</div>
<a class="anchor" id="a9e712440333d857c99be492d1a0e0372"></a><!-- doxytag: member="rtu_fd.c::rtu_htab" ref="a9e712440333d857c99be492d1a0e0372" args="[HTAB_ENTRIES][RTU_BUCKETS]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structfiltering__entry.html">filtering_entry</a> <a class="el" href="rtu__fd_8c.html#a9e712440333d857c99be492d1a0e0372">rtu_htab</a>[HTAB_ENTRIES][RTU_BUCKETS]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Mirror of ZBT SRAM memory MAC address table. Main filtering table organized as hash table with 4-entry buckets. Note both banks have the same content. Therefore SW only mirrors one bank. </p>

</div>
</div>
<a class="anchor" id="acbfec691155f65d61cb3501647b82ded"></a><!-- doxytag: member="rtu_fd.c::vlan_tab" ref="acbfec691155f65d61cb3501647b82ded" args="[NUM_VLANS]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structvlan__table__entry.html">vlan_table_entry</a> <a class="el" href="rtu__fd_8c.html#acbfec691155f65d61cb3501647b82ded">vlan_tab</a>[NUM_VLANS]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Mirror of VLAN table </p>

</div>
</div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Thu Feb 3 2011 17:09:03 for wrsw_rtud by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.2 </small></address>
</body>
</html>
